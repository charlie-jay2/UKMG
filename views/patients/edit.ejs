<%- include('../partials/header') %>
<div class="container mt-5">
  <h1>Add New Record for <%= patient.name %></h1>
  <form method="POST" action="/patients/<%= patient._id %>?_method=PUT">
    <div class="mb-3">
      <label class="form-label">Stage</label>
      <select name="stage" class="form-select" id="stage" onchange="toggleTriageFields(this)">
        <option value="Triage">Triage</option>
        <option value="Medical Treatment">Medical Treatment</option>
        <option value="Discharged">Discharged</option>
      </select>
    </div>

    <!-- Triage specific fields (hidden by default) -->
    <div id="triageFields" style="display: none;">
      <h4>Patient Clinical Details:</h4>
      <div class="mb-3">
        <label class="form-label">Initial Workup (Time)</label>
        <input type="text" name="clinicalDetails[initialWorkupTime]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Presenting Complaint</label>
        <input type="text" name="clinicalDetails[presentingComplaint]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Events Leading Up To Complaint</label>
        <input type="text" name="clinicalDetails[eventsLeadingUpToComplaint]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Drug History</label>
        <input type="text" name="clinicalDetails[drugHistory]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Allergies</label>
        <input type="text" name="clinicalDetails[allergies]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Medical History</label>
        <input type="text" name="clinicalDetails[medicalHistory]" class="form-control">
      </div>

      <h4>Social History:</h4>
      <div class="mb-3">
        <label class="form-check-label">PT Drink Regularly?</label>
        <input type="checkbox" name="socialHistory[drinkRegularly]" class="form-check-input custom-checkbox">
      </div>
      <div class="mb-3">
        <label class="form-check-label">PT Smokes?</label>
        <input type="checkbox" name="socialHistory[smokes]" class="form-check-input custom-checkbox">
      </div>
      <div class="mb-3">
        <label class="form-check-label">PT Lives Alone?</label>
        <input type="checkbox" name="socialHistory[livesAlone]" class="form-check-input custom-checkbox">
      </div>
      <div class="mb-3">
        <label class="form-check-label">PT Employed?</label>
        <input type="checkbox" name="socialHistory[employed]" class="form-check-input custom-checkbox">
      </div>

      <h4>Observations (Time):</h4>
      <div class="mb-3">
        <label class="form-label">HR</label>
        <input type="text" name="observations[hr]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">SP02</label>
        <input type="text" name="observations[sp02]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">BP</label>
        <input type="text" name="observations[bp]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">RR</label>
        <input type="text" name="observations[rr]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">TEMP</label>
        <input type="text" name="observations[temp]" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Taken By</label>
        <input type="text" name="observations[takenBy]" class="form-control">
      </div>
    </div>

    <!-- Notes section (visible for all stages) -->
    <div class="mb-3">
      <label class="form-label">Notes</label>
      <textarea name="notes" class="form-control" rows="4" required></textarea>
    </div>
    <button class="btn btn-success">Update Record</button>
  </form>
</div>

<%- include('../partials/footer') %>

<script>
  // Function to toggle Triage-specific fields
  function toggleTriageFields(selectElement) {
    const triageFields = document.getElementById('triageFields');
    if (selectElement.value === 'Triage') {
      triageFields.style.display = 'block';
    } else {
      triageFields.style.display = 'none';
    }
  }
</script>

<style>
  .custom-checkbox {
    transform: scale(1.3); /* Enlarges the checkbox for better visibility */
    margin-right: 10px; /* Adds space between the checkbox and the label */
    border: 2px solid #000; /* Adds a bolder border */
    border-radius: 4px; /* Rounded corners for the checkbox */
    padding: 5px; /* Adds padding inside the checkbox for better appearance */
  }

  .custom-checkbox:checked {
    background-color: #28a745; /* Green background for checked state */
    border-color: #28a745; /* Matching green border when checked */
  }

  .form-check-label {
    font-weight: 500; /* Makes the label text slightly bolder for better readability */
  }

  .form-check-input {
    margin-left: 10px; /* Adds space between the label and checkbox */
  }
</style>

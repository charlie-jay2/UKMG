<%- include('../partials/header') %>
<div class="container mt-5">
  <h1><%= patient.name %></h1>
  <p><strong>Age:</strong> <%= patient.age %></p>
  <p><strong>NHS Number:</strong> <%= patient.nhsNumber %></p>
  <p><strong>Initial Condition:</strong> <%= patient.condition %></p>

  <h3 class="mt-4">Medical Records</h3>
  <% if (patient.medicalRecords.length === 0) { %>
    <p>No records yet.</p>
  <% } else { %>
    <ul class="list-group">
      <% 
        let previousDate = null; // Track the previous record's date
        patient.medicalRecords.forEach(record => { 
        const recordDate = new Date(record.updatedAt).toLocaleDateString(); // Get the formatted date
      %>

        <% if (previousDate !== null && recordDate !== previousDate) { %>
          <!-- Add a separator line if the date has changed -->
          <li class="list-group-item">
            <hr>
            <small class="text-muted">New history above: <%= recordDate %></small>
            <hr>
          </li>
        <% } %>

        <li class="list-group-item">
          <strong>Stage:</strong> <%= record.stage %><br />
          <strong>Notes:</strong> <%= record.notes %><br />
          <small><%= new Date(record.updatedAt).toLocaleString() %></small>
        </li>

        <% previousDate = recordDate; // Update the previous date with the current one %>
      <% }) %>
    </ul>
  <% } %>

  <a href="/patients/<%= patient._id %>/edit" class="btn btn-primary mt-3">Add New Record</a>
</div>
<%- include('../partials/footer') %>
